# Phase 1: Static Component Architecture

## Goal Description
Implement a hybrid rendering architecture that uses `Static` components for historical messages and `VirtualizedList` for the alternate buffer or when specifically required. This is expected to provide a ~50% performance improvement in rendering speed and reduce CPU usage.

## User Review Required
> [!IMPORTANT]
> This change introduces a new `useRenderMode` hook and modifies `MainContent.tsx` significantly. It relies on the `@jrichman/ink` version verified in Phase 0.

## Proposed Changes

### UI Components
#### [MODIFY] [MainContent.tsx](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code/packages/cli/src/ui/components/MainContent.tsx)
- Refactor to support dual rendering modes:
    - **Static Mode**: Uses `<Static>` for history items (default for normal buffer).
    - **Virtualized Mode**: Uses `<ScrollableList>` (existing logic) for alternate buffer or screen reader mode.
- Implement `useRenderMode` hook integration.

#### [NEW] [useRenderMode.ts](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code/packages/cli/src/ui/hooks/useRenderMode.ts)
- Logic to determine whether to use `static` or `virtualized` rendering based on:
    - `useAlternateBuffer()`
    - `useIsScreenReaderEnabled()`
    - Settings/Feature flags

### State Management
#### [MODIFY] [UIStateContext.tsx](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code/packages/cli/src/ui/contexts/UIStateContext.tsx)
- Add `historyRemountKey` to state.
- Add `incrementHistoryRemountKey` action.
- Split `history` into `history` (completed) and `pendingHistory` (streaming) to optimize Static rendering updates.

## Verification Plan

### Automated Tests
- Run `npm run test` to ensure no regressions in existing UI logic.
- Run the newly created performance baseline test to measure improvement.

### Manual Verification
- Verify normal chat flow (Static mode).
- Verify alternate buffer (e.g., using a tool that triggers it) (Virtualized mode).
- Verify screen reader mode (if possible).
