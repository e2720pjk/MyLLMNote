# UI Optimization Migration - Task Tracker

## Phase 0: Ink Version Evaluation ✅

- [x] Verify @jrichman/ink@6.4.6 compatibility
- [x] Run existing tests
- [x] Create performance baseline test
- [x] Document verification results

## Phase 3: TabBar Integration
  - [x] Extend `UIStateContext` with tab management (activeTab, tabs array).
  - [x] Implement [TabBar](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/components/TabBar.tsx#25-85) component with keyboard shortcuts.
  - [x] Create placeholder components for [DebugTab](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/components/tabs/DebugTab.tsx#17-108), [TodoTab](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code/packages/cli/src/ui/components/tabs/TodoTab.tsx#14-27), [SystemTab](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code/packages/cli/src/ui/components/tabs/SystemTab.tsx#14-123).
  - [x] Refactor [MainContent](file:///Users/caishanghong/Shopify/cli-tool/gemini-cli/packages/cli/src/ui/components/MainContent.tsx#23-155) to integrate [TabBar](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/components/TabBar.tsx#25-85) and conditional rendering.
  - [x] Add key bindings for tab switching (Ctrl+1-4, Ctrl+O).
  - [x] Port [DebugTab](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/components/tabs/DebugTab.tsx#17-108) content from `llxprt-code-3` (console messages display).
  - [x] Verify implementation with preflight checks and tests.

## Phase 4: Remaining Tabs Porting ✅
  - [x] Port [TodoTab](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code/packages/cli/src/ui/components/tabs/TodoTab.tsx#14-27) (integrate with `TodoPanel`).
  - [x] Port [SystemTab](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code/packages/cli/src/ui/components/tabs/SystemTab.tsx#14-123) (implement system info display).
  - [x] Verify implementation with preflight checks.

- [x] **Phase 5: Refactoring & Integration** ✅
  - [x] Stage 1: Basic Cleanup (Fix TabBar hint, Resolve Ctrl+O conflict).
  - [x] Stage 2: Enhance Debug Tab (Migrate Error Details, Add MCP Status, Align Static Strategy, Add Header).
  - [x] Stage 3: MCP & System Integration (System Tab stats).
  - [x] Stage 4: Tab Status Indicators (Visual cues for updates).
  - [x] Stage 5: Code Cleanup (Remove DetailedMessagesDisplay).

## Phase 1.1: Screen Reader Support ✅

- [x] Create ScreenReaderAppLayout.tsx
  - [x] Implement component with SR-optimized layout (Footer on top, 90% width)
  - [x] Analyze upstream changes in `llxprt-code-4`
- [x] Port Tabs feature components and state management
- [x] Integrate upstream UI improvements into ported components
- [x] Fix keybindings and remove redundant UI logic
- [x] Resolve all TypeScript and Lint errors
    - [x] Fix [MainContent.tsx](file:///Users/caishanghong/Shopify/cli-tool/gemini-cli/packages/cli/src/ui/components/MainContent.tsx) property mismatches
    - [x] Fix [ScreenReaderAppLayout.tsx](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code/packages/cli/src/ui/layouts/ScreenReaderAppLayout.tsx) Footer props
    - [x] Fix missing module imports (`AppContext`, `useAlternateBuffer`, etc.)
    - [x] Address `RenderOptions` discrepancies
- [x] Verify build and basic functionality
  - [x] Test mode switching (conditional rendering verified)
  - [x] Run test suite (typecheck, lint passed)
- [x] (Optional) Remove pendingHistory field
  - [x] Investigation complete: gemini-cli doesn't use this field
  - [x] Decision: Keep for now (non-blocking, backward compatible)

## Phase 2: Systematic Memoization ✅

- [x] Memoize Stats Display Components
  - [x] StatsDisplay.tsx - Wrapped with React.memo
  - [x] ModelStatsDisplay.tsx - Wrapped with React.memo
  - [x] CacheStatsDisplay.tsx - Wrapped with React.memo
  - [x] ToolStatsDisplay.tsx - Wrapped with React.memo
- [x] Verification
  - [x] TypeScript typecheck passed
  - [x] Lint checks passed
  - [x] Tests passed
  - [x] Build succeeded

## Phase 2+: Future Enhancements (Not Started)

- [ ] Flicker Prevention system integration
- [ ] Advanced Memory Management
- [ ] Additional accessibility features
- [ ] Performance testing and benchmarking

## Phase 6: Upstream Synchronization (PR #845)
- [ ] Port [oldui-tmux-harness.js](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-4/scripts/oldui-tmux-harness.js) and test scripts
- [ ] Update [ScrollableList](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-4/packages/cli/src/ui/components/shared/ScrollableList.tsx#40-153), [VirtualizedList](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-4/packages/cli/src/ui/components/shared/ScrollableList.tsx#25-33), `useAnimatedScrollbar`
- [ ] Verify with test harness
