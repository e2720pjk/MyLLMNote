# Fix MouseContext Error in llxprt-code-3

## Goal Description
The goal is to resolve the `React Error Boundary caught an error: Error: useMouseContext must be used within a MouseProvider` error in `llxprt-code-3`.
This error occurs because components using [useMouseContext](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/contexts/MouseContext.tsx#38-45) (like [ScrollableList](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/components/shared/ScrollableList.tsx#44-248)) are not wrapped in a [MouseProvider](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/contexts/MouseContext.tsx#59-167).
We will fix this by adding [MouseProvider](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/contexts/MouseContext.tsx#59-167) to the main application entry point, similar to how it is done in `gemini-cli`.

## User Review Required
> [!IMPORTANT]
> This change involves modifying the main entry point of the application to wrap the app in [MouseProvider](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/contexts/MouseContext.tsx#59-167). This is a structural change but should be safe as it only provides context.

## Proposed Changes

### packages/cli/src/ui/App.tsx

#### [MODIFY] [AppWrapper Component](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/App.tsx)
- Import [MouseProvider](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/contexts/MouseContext.tsx#59-167) from `./contexts/MouseContext.js`.
- Import [ScrollProvider](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/contexts/ScrollProvider.tsx#76-350) from `./contexts/ScrollProvider.js`.
- Import [isAlternateBufferEnabled](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/hooks/useAlternateBuffer.ts#10-12) from `./hooks/useAlternateBuffer.js`.
- In [AppWrapper](file:///Users/caishanghong/Shopify/cli-tool/gemini-cli/packages/cli/src/gemini.tsx#206-239):
    - Calculate `mouseEventsEnabled`: [isAlternateBufferEnabled(props.settings) && !props.config.getScreenReader()](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/hooks/useAlternateBuffer.ts#10-12).
    - Wrap the component tree with [MouseProvider](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/contexts/MouseContext.tsx#59-167) (passing `mouseEventsEnabled` and `debugKeystrokeLogging`).
    - Wrap with [ScrollProvider](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/contexts/ScrollProvider.tsx#76-350) inside [MouseProvider](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/contexts/MouseContext.tsx#59-167).
    
### packages/cli/src/ui/components/InputPrompt.tsx

#### [MODIFY] [InputPrompt Component](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/components/InputPrompt.tsx)
- Import [useMouse](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/contexts/MouseContext.tsx#46-58) and `useMouseClick` hooks.
- Import [useUIActions](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/contexts/UIActionsContext.tsx#148-155).
- Add `isEmbeddedShellFocused` to [InputPromptProps](file:///Users/caishanghong/Shopify/cli-tool/gemini-cli/packages/cli/src/ui/components/InputPrompt.tsx#62-87).
- Implement `useMouseClick` to handle cursor positioning.
- Implement [useMouse](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/contexts/MouseContext.tsx#46-58) to handle right-click paste.
- Use [useUIActions](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/contexts/UIActionsContext.tsx#148-155) to set embedded shell focus state.

### packages/cli/src/ui/components/Composer.tsx

#### [MODIFY] [Composer Component](file:///Users/caishanghong/Shopify/cli-tool/llxprt-code-3/packages/cli/src/ui/components/Composer.tsx)
- Pass `isEmbeddedShellFocused` from `uiState` to [InputPrompt](file:///Users/caishanghong/Shopify/cli-tool/gemini-cli/packages/cli/src/ui/components/InputPrompt.tsx#104-1182).

## Verification Plan

### Automated Tests
- Run existing tests to ensure no regressions.
- `npm run test`

### Manual Verification
- Run the application and verify that the error is gone.
- Verify that mouse interactions (scrolling, clicking) work as expected in the UI components that use them.
